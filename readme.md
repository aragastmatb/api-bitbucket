# Автоматизации работы с bitbucket

## Общие положения

Для корректного исполнения необходим python версии 3.6 или выше
Библиотеки, необходимые для запуска находятся в файле req.txt
Вызов pip для установки этих библиотек располагается в файле pip.bat

## Изменение настроек хука кросс-доменной синхронизации

### Синтаксис вызова main.py

main.py [-h] [-f] user password regexp replace

| аргумент | описание |
|-------------|-----------------------------------------|
| user | Логин, под которым скрипт должен подключится к Stash |
| password | Пароль от логина |
| regexp | Регулярка, по которой производится поиск параметра в настройках хука. Пример:".\*--jenkins-job-url=([A-Za-z0-9\\-\\/_\\.:]+)\s\*" писать без кавычек и пробелов |
| replace | Строка, которая содержит новый параметр для замены Пример: "jenkins-job-url=https://bitbucket.ru/project/null/\r\n" писать без кавычек и пробелов |
| -h, --help | покажет данную справку |
| -f, --force | Флаг, указывается, если нужно произвести замену параметра, иначе, делает только вычитку |

### Комментарии к main.py

Регулярку следует начинать с ".*", иначе он начнёт искать параметр для скрипта, вместо того, чтобы считать эту строку значением
Строка замены пишется без "--", так как эти символы добавляются в харкоде

### Пример вызова команды main.py

python main.py login password .\*--jenkins-job-url=([A-Za-z0-9\\-\\/_\\.:]+)\s\* jenkins-job-url=https://bitbucket.ru/project/null/\r\n -f

## Изменение прав на ветки

Перед запуском необходимо удостоверится в наличии правильной ссылки на систему в файле environment.py. Используется только параметр url, остальные, в текущей реализации, нужны для подмены на необходимый адрес.

### Синтаксис вызова restrictions.py

restrictions.py [-n NEW_USER] user password

| аргумент | описание |
|-------------|-----------------------------------------|
| user | Логин, под которым скрипт должен подключится к Stash |
| password | Пароль от логина |
| -n, --new | Логин пользователя(ТУЗа), который будет добавлен во все Branch Permission всех репозиториев|

### Пример вызова команды restrictions.py

python restrictions.py -n new_user_login user password